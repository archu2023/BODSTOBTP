{% extends 'base.html' %}
{% block content%}
{% load static %}
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.canvasjs.com/ga/canvasjs.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    
    /* Create three equal columns that floats next to each other */
    .column {
      float: left;
      width: 33%;
      padding: 10px;
      height: 210px; 
      display: flex; 
      }
    
    /* Clear floats after the columns */
    .row:after {
      content: "";
      display: table;
      clear: both;
    }
  </style>
</head>
<body>
<div class="summary">
  <p class="summaryfirstline"> Data Services to Data Intelligence Migration Platform </p>
  <p class="summarysecondline"> Summary <p>
  <h3 class="client"> Client Landscape</h3> 
  <div class="row">
    <div class="column" style="background-color:#f3f3f3;">
      <head> 
        <style>
          canvas {
              max-width: 600px;
              margin: 20px auto;
          }
          {% comment %} #barGraph1 {
            height: 250px;
          } {% endcomment %}
        </style>
      </head>
      <body>
        <div class="graph-container">
          <h6 style="font-weight: bold;">Source</h6>
          <canvas id="barGraph1"></canvas> 
          <span>Complexity</span>
        </div>
        <script>
            var ctx1 = document.getElementById('barGraph1').getContext('2d');
            var data_set_1 = {{ data_set_1|safe }};
            var label1 = {{ label1|safe }};
            var backgroundColors = ['#002060', '#2E76B7', '#00B5D9'];
            var chart1 = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: label1,
                    datasets: [{
                        label: '',
                        data: data_set_1,
                        backgroundColor: backgroundColors.slice(0, label1.length), // Use slice to limit colors
                        borderColor: backgroundColors.slice(0, label1.length),
                        borderWidth: 1
                    }]
                    
                },
                options: {
                    // Customize options if needed
                    plugins: {
                      legend: {
                        labels: {
                          boxWidth: 0 // Optional width of colored boxes
                        }
                      }
                  },
                    scales: {
                      y: {
                          beginAtZero: true,
                          title: {
                              display: true,
                              text: 'Data Services' // Your y-axis label
                          }
                      }
                  },
                }
            });
          </script>   
    </div>
    <div class="column" style="background-color:f3f3f3;">
      <head>
        <style>
          canvas {
            max-width: 600px;
            margin: 20px auto; 
          }
          .chart-container {
              position: relative;
              text-align: center;
              height: 200px;
          }
          .chart-label {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              font-size: 20px;
          } 
        </style>
      </head>
      <body>
        <div class="chart-container">
          <h6 style="font-weight: bold;">Validation</h6>
          <canvas id="donutChart"></canvas>  
       </div>
        <script>
          // Accessing values passed from Django view
          const totalFiles = {{ total_files }};
          const validFiles = {{ valid_files }};
          const invalidFiles = {{ invalid_files }};
          // Calculate percentages
          const validPercentage = (validFiles / totalFiles) * 100;
          const invalidPercentage = (invalidFiles / totalFiles) * 100;
          var ctx2 = document.getElementById('donutChart').getContext('2d');
          var data = [validPercentage, invalidPercentage];
          var label2 = {{ label2|safe }};
          var chart2 = new Chart(ctx2, {
          type: 'doughnut',
          data: {
            datasets: [{
                data: data,
                backgroundColor: ['#2e76b7', '#002060'],
                borderColor: ['#2e76b7', '#002060'],
                borderWidth: 1
            }],
            labels: label2
          },
          options: {
            cutoutPercentage: 70,
            animation: {
                animateRotate: true,
                animateScale: true
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        fontSize: 10,
                        boxWidth: 15
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed !== null) {
                                label = (context.parsed).toFixed(2) + '%';
                            }
                            return label;
                        }
                    }
                 
                }
            }
          }
          });
        </script>
      </body>
    </div>
    <div class="column" style="background-color:#f3f3f3;">
      <head>
        <style>
          canvas {
            max-width: 600px;
            margin: 20px auto;
          }
        </style>
      </head>
      <body>
        <div class="graph-container">
          <h6 style="font-weight: bold;">Target</h6>
          <canvas id="barGraph2"></canvas>
          <span>Indicative Effort</span>
        </div>
        <script>
            var ctx2 = document.getElementById('barGraph2').getContext('2d');
            var data_set_3 = {{ data_set_3|safe }};
            var label3 ={{ label3| safe }};
            var backgroundColors = ['#002060', '#2E76B7', '#00B5D9'];
            var chart3 = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: label3,
                    datasets: [{
                        label: '',
                        data: data_set_3,
                        backgroundColor: backgroundColors.slice(0, label3.length), // Use slice to limit colors
                        borderColor: backgroundColors.slice(0, label3.length),
                        borderWidth: 1
                    }]
                },
                options: {
                  // Customize options if needed
                  plugins: {
                    legend: {
                      {% comment %} position: 'bottom', {% endcomment %}
                      align: 'center',
                      labels: {
                        boxWidth: 0 // Optional width of colored boxes
                      }
                    }
                  },
                  scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Data Services' // Your y-axis label
                        }
                    }
                    
                  },
                }
            });
        </script>
      </body>
    </div>
  </div>
  <div class="summarytable">
    <div>
      <h3 class="estimation">Estimation</h3>
    </div> 
    <div>
      {% comment %} <a href="#" class="export-link">
        <img src="{% static 'export_icon.png' %}" alt="Export Icon">
        Export Report
      </a> {% endcomment %}
      {% comment %} <a href="#" class="btn btn-primary">Export as PDF</a> {% endcomment %}
      <div class = "d-flex flex-row justify-content-end mb-2">
        <button id="ExportPdfButton">Export to PDF</button>
      </div>
    </div>
    <div class="data-tab-container"
        style="overflow: hidden; overflow-x: auto; overflow-y: auto">
        <table class="dynamic-table data-tab-container" id="dynamic-table">
      <thead>
        <tr>
          <th>No</th>
          <th>File Name</th>
          <th>Job Name</th>
          <th>Source Complexity</th>
          <th>Target Coverage</th>
          <th>Indicative Effort</th>
        </tr>
      </thead>
        <tbody>
          <!-- Table rows will be dynamically generated here -->
          {% for element in data %}
          <tr>
            <td>{{ element.sl_no }}</td>
            <td>{{ element.file_name }}</td>
            <td>{{ element.Job_name }}</td>
            <td>{{ element.Complexity }}</td>
            <td>{{ element.coverage }}</td>
            <td>{{ element.effort }}</td>
          </tr>  
          {% endfor %}
        </tbody>
    </table>
  </div>

    <script>
      document.getElementById('ExportPdfButton').addEventListener('click', function () {
        // Options for html2pdf
        const options = {
            margin: 10,
            filename: 'summary_table_file.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
        };
 
        // Use html2pdf to generate PDF from the current page
        html2pdf().from(document.getElementById('dynamic-table')).set(options).save();
    });
    </script>
  <br>
    <form id="myForm" method="post" >
      {% csrf_token %}
      <input type="text" id="inputField" name="user_path" placeholder="Enter the destination for your File Path..."><br>
      <button type="submit">Convert</button>
    </form> 
</div>

{% endblock %}